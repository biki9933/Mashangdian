{"remainingRequest":"D:\\git\\Mashangdian\\Vue\\saoma-diancan-pc\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\git\\Mashangdian\\Vue\\saoma-diancan-pc\\src\\page\\login\\login.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\git\\Mashangdian\\Vue\\saoma-diancan-pc\\src\\page\\login\\login.vue","mtime":1733139801575},{"path":"D:\\git\\Mashangdian\\Vue\\saoma-diancan-pc\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1733062317302},{"path":"D:\\git\\Mashangdian\\Vue\\saoma-diancan-pc\\node_modules\\babel-loader\\lib\\index.js","mtime":1733062318538},{"path":"D:\\git\\Mashangdian\\Vue\\saoma-diancan-pc\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1733062317302},{"path":"D:\\git\\Mashangdian\\Vue\\saoma-diancan-pc\\node_modules\\vue-loader\\lib\\index.js","mtime":1733062316941}],"contextDependencies":[],"result":["\r\nimport { Urls } from '../../api/api.js'\r\n\r\nexport default {\r\n    data() {\r\n        return {\r\n            load: false,\r\n            userName: '',\r\n            password: '',\r\n            selectedMerchant: '',\r\n            merchantList: [],\r\n            Urls: Urls\r\n        }\r\n    },\r\n    created() {\r\n        this.getMerchantList()\r\n    },\r\n    methods: {\r\n        async getMerchantList() {\r\n            try {\r\n                const res = await new this.Request(this.Urls.admin.merchantList).modeget()\r\n                console.log('商户列表响应:', res)\r\n                \r\n                if (res.code === 0) {\r\n                    this.merchantList = res.merchantList\r\n                } else {\r\n                    this.$message.error(res.msg || '获取商户列表失败')\r\n                }\r\n            } catch (e) {\r\n                console.error('获取商户列表错误:', e)\r\n                this.$message.error('获取商户列表失败')\r\n            }\r\n        },\r\n\r\n        handleMerchantChange(merchantId) {\r\n            this.userName = ''\r\n            this.password = ''\r\n        },\r\n\r\n        async signin() {\r\n            if (!this.selectedMerchant) {\r\n                this.$message.warning('请选择商户！')\r\n                return\r\n            }\r\n            if (!this.userName) {\r\n                this.$message.warning('请输入用户名！')\r\n                return\r\n            }\r\n            if (!this.password) {\r\n                this.$message.warning('请输入密码！')\r\n                return\r\n            }\r\n\r\n            this.load = true\r\n            const loginData = {\r\n                userName: this.userName,\r\n                password: this.password,\r\n                merchantId: this.selectedMerchant\r\n            }\r\n\r\n            try {\r\n                const res = await new this.Request(this.Urls.admin.login, loginData).modepost()\r\n                if (res.code === 0) {\r\n                    // 更新vuex状态\r\n                    this.$store.commit('SET_MERCHANT', {\r\n                        id: res.data.adminInfo.merchantId,\r\n                        name: res.data.adminInfo.merchantName\r\n                    })\r\n                    \r\n                    // 保存token\r\n                    this.$store.commit('SET_USER_INFO', {\r\n                        token: res.data.token,\r\n                        userInfo: {\r\n                            userName: this.userName,\r\n                            merchantId: res.data.adminInfo.merchantId\r\n                        }\r\n                    })\r\n\r\n                    // 显示成功消息\r\n                    this.$message.success('登录成功')\r\n                    \r\n                    // 获取重定向地址\r\n                    const redirect = this.$route.query.redirect || '/'\r\n                    // 跳转\r\n                    this.$router.push(redirect)\r\n                } else {\r\n                    this.$message.warning(res.msg || '登录失败')\r\n                }\r\n            } catch (e) {\r\n                console.error('登录错误:', e)\r\n                this.$message.error('登录异常，请重试')\r\n            } finally {\r\n                this.load = false\r\n            }\r\n        }\r\n\t}\r\n}\r\n\r\n",{"version":3,"sources":["login.vue"],"names":[],"mappings":";AA+BA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"login.vue","sourceRoot":"src/page/login","sourcesContent":["<template>\r\n    <div id=\"backcont\">\r\n        <div class=\"meituan-content\">\r\n            <div class=\"login-cont\">\r\n                <div class=\"meituan-title\">扫码点餐登录</div>\r\n                <div class=\"meituan-user\">\r\n                    <p>商户</p>\r\n                    <el-select class=\"inptflex\" v-model=\"selectedMerchant\" placeholder=\"请选择商户\" @change=\"handleMerchantChange\">\r\n                        <el-option\r\n                            v-for=\"item in merchantList\"\r\n                            :key=\"item.id\"\r\n                            :label=\"item.merchantName\"\r\n                            :value=\"item.id\">\r\n                        </el-option>\r\n                    </el-select>\r\n                </div>\r\n                <div class=\"meituan-user\">\r\n                    <p>账号</p>\r\n                    <el-input class=\"inptflex\" v-model=\"userName\" placeholder=\"请输入账号\" :disabled=\"!selectedMerchant\"></el-input>\r\n                </div>\r\n                <div class=\"meituan-user\">\r\n                    <p>密码</p>\r\n                    <el-input class=\"inptflex\" v-model=\"password\" placeholder=\"请输入密码\" show-password :disabled=\"!selectedMerchant\"></el-input>\r\n                </div>\r\n                <el-button type=\"success\" class=\"meituan-btn\" @click=\"signin()\" :loading=\"load\" :disabled=\"load || !selectedMerchant\">登录</el-button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { Urls } from '../../api/api.js'\r\n\r\nexport default {\r\n    data() {\r\n        return {\r\n            load: false,\r\n            userName: '',\r\n            password: '',\r\n            selectedMerchant: '',\r\n            merchantList: [],\r\n            Urls: Urls\r\n        }\r\n    },\r\n    created() {\r\n        this.getMerchantList()\r\n    },\r\n    methods: {\r\n        async getMerchantList() {\r\n            try {\r\n                const res = await new this.Request(this.Urls.admin.merchantList).modeget()\r\n                console.log('商户列表响应:', res)\r\n                \r\n                if (res.code === 0) {\r\n                    this.merchantList = res.merchantList\r\n                } else {\r\n                    this.$message.error(res.msg || '获取商户列表失败')\r\n                }\r\n            } catch (e) {\r\n                console.error('获取商户列表错误:', e)\r\n                this.$message.error('获取商户列表失败')\r\n            }\r\n        },\r\n\r\n        handleMerchantChange(merchantId) {\r\n            this.userName = ''\r\n            this.password = ''\r\n        },\r\n\r\n        async signin() {\r\n            if (!this.selectedMerchant) {\r\n                this.$message.warning('请选择商户！')\r\n                return\r\n            }\r\n            if (!this.userName) {\r\n                this.$message.warning('请输入用户名！')\r\n                return\r\n            }\r\n            if (!this.password) {\r\n                this.$message.warning('请输入密码！')\r\n                return\r\n            }\r\n\r\n            this.load = true\r\n            const loginData = {\r\n                userName: this.userName,\r\n                password: this.password,\r\n                merchantId: this.selectedMerchant\r\n            }\r\n\r\n            try {\r\n                const res = await new this.Request(this.Urls.admin.login, loginData).modepost()\r\n                if (res.code === 0) {\r\n                    // 更新vuex状态\r\n                    this.$store.commit('SET_MERCHANT', {\r\n                        id: res.data.adminInfo.merchantId,\r\n                        name: res.data.adminInfo.merchantName\r\n                    })\r\n                    \r\n                    // 保存token\r\n                    this.$store.commit('SET_USER_INFO', {\r\n                        token: res.data.token,\r\n                        userInfo: {\r\n                            userName: this.userName,\r\n                            merchantId: res.data.adminInfo.merchantId\r\n                        }\r\n                    })\r\n\r\n                    // 显示成功消息\r\n                    this.$message.success('登录成功')\r\n                    \r\n                    // 获取重定向地址\r\n                    const redirect = this.$route.query.redirect || '/'\r\n                    // 跳转\r\n                    this.$router.push(redirect)\r\n                } else {\r\n                    this.$message.warning(res.msg || '登录失败')\r\n                }\r\n            } catch (e) {\r\n                console.error('登录错误:', e)\r\n                this.$message.error('登录异常，请重试')\r\n            } finally {\r\n                this.load = false\r\n            }\r\n        }\r\n\t}\r\n}\r\n\r\n</script>\r\n\r\n<style scoped=\"scoped\">\r\n#backcont {\r\n\tbackground-image: url(../../../static/login/beijing.jpg);\r\n\tbackground-attachment: fixed;\r\n\tbackground-repeat: no-repeat;\r\n\tbackground-size: cover;\r\n\t-webkit-background-size: cover;\r\n\tmoz-background-size: cover;\r\n\tmin-height: 100vh;\r\n}\r\n.meituan-content {\r\n\tposition: absolute;\r\n\ttop: 50%;\r\n\tleft: 50%;\r\n\ttransform: translate(-50%, -50%);\r\n}\r\n.login-cont {\r\n\twidth: 500px;\r\n\theight: 300px;\r\n\tbackground: #f9de80;\r\n\tborder-radius: 5px;\r\n}\r\n.meituan-title {\r\n\ttext-align: center;\r\n\tcolor: #000000;\r\n\tfont-size: 30px;\r\n\tpadding-top: 30px;\r\n\tfont-family: Arial, Helvetica, sans-serif;\r\n}\r\n.meituan-user {\r\n\twidth: 400px;\r\n\tmargin: 0 auto;\r\n\tpadding-top: 30px;\r\n\theight: 40px;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n}\r\n\r\n.meituan-user p{width: 50px; color: #000000;\r\nfont-size:16px;\r\n}\r\n\r\n.inptflex{flex: 1;}\r\n\r\n.reg-view{\r\n\twidth: 400px;\r\n\tdisplay: flex;\r\n\tjustify-content: flex-end;\r\n\tmargin: 0 auto;\r\n\tpadding-top: 10px;\r\n\tcursor:pointer;\r\n}\r\n\r\n.meituan-btn {\r\n\twidth: 200px;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tmargin: 20px auto 0 auto;\r\n\tfont-size: 16px;\r\n}\r\n</style>\r\n"]}]}