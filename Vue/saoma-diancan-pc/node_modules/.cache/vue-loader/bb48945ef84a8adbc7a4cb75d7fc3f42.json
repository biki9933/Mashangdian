{"remainingRequest":"D:\\git\\Mashangdian\\Vue\\saoma-diancan-pc\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\git\\Mashangdian\\Vue\\saoma-diancan-pc\\src\\page\\dish-management\\dishes-list.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\git\\Mashangdian\\Vue\\saoma-diancan-pc\\src\\page\\dish-management\\dishes-list.vue","mtime":1733924163789},{"path":"D:\\git\\Mashangdian\\Vue\\saoma-diancan-pc\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1733062317302},{"path":"D:\\git\\Mashangdian\\Vue\\saoma-diancan-pc\\node_modules\\babel-loader\\lib\\index.js","mtime":1733062318538},{"path":"D:\\git\\Mashangdian\\Vue\\saoma-diancan-pc\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1733062317302},{"path":"D:\\git\\Mashangdian\\Vue\\saoma-diancan-pc\\node_modules\\vue-loader\\lib\\index.js","mtime":1733062316941}],"contextDependencies":[],"result":["\r\nimport { mapGetters } from 'vuex'\r\nimport { BASE_URL } from '@/config'\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tloading: false,\r\n\t\t\tdishesList: [],\r\n\t\t\tbaseUrl: BASE_URL\r\n\t\t}\r\n\t},\r\n\t\r\n\tcomputed: {\r\n\t\t...mapGetters(['currentMerchant']),\r\n\t\tgetOnSaleCount() {\r\n\t\t\treturn this.dishesList.filter(dish => dish.onsale).length\r\n\t\t},\r\n\t\tgetTotalSales() {\r\n\t\t\treturn this.dishesList.reduce((sum, dish) => sum + dish.monthlysale, 0)\r\n\t\t}\r\n\t},\r\n\t\r\n\tcreated() {\r\n\t\tthis.getDishesList()\r\n\t},\r\n\t\r\n\tmethods: {\r\n\t\t// 获取菜品列表\r\n\t\tasync getDishesList() {\r\n\t\t\tthis.loading = true\r\n\t\t\ttry {\r\n\t\t\t\tconst params = {\r\n\t\t\t\t\tmerchantId: this.currentMerchant.id\r\n\t\t\t\t}\r\n\t\t\t\tconst res = await new this.Request('/admin/dish/list').modepost(params)\r\n\t\t\t\t\r\n\t\t\t\tif (res.code === 0) {\r\n\t\t\t\t\tthis.dishesList = res.dishList || []\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$message.error(res.msg || '获取菜品列表失败')\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('获取菜品列表失败：', error)\r\n\t\t\t\tthis.$message.error('获取菜品列表失败')\r\n\t\t\t} finally {\r\n\t\t\t\tthis.loading = false\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 修改菜品状态\r\n\t\tasync handleStatusChange(dish) {\r\n\t\t\ttry {\r\n\t\t\t\tconst params = {\r\n\t\t\t\t\tid: dish.id,\r\n\t\t\t\t\tonsale: dish.onsale,\r\n\t\t\t\t\tmerchantId: this.currentMerchant.id\r\n\t\t\t\t}\r\n\t\t\t\tconst res = await new this.Request('/admin/dish/updateOnSale', params).modepost()\r\n\t\t\t\t\r\n\t\t\t\tif (res.code === 0) {\r\n\t\t\t\t\tthis.$message.success('状态修改成功')\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdish.onsale = !dish.onsale // 恢复状态\r\n\t\t\t\t\tthis.$message.error(res.msg || '状态修改失败')\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tdish.onsale = !dish.onsale // 恢复状态\r\n\t\t\t\tthis.$message.error('状态修改失败')\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 编辑菜品\r\n\t\teditDish(dish) {\r\n\t\t\tthis.$router.push({\r\n\t\t\t\tname: 'upload',\r\n\t\t\t\tparams: { item: dish }\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\t// 删除菜品\r\n\t\tasync deleteDish(dish) {\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log('Deleting dish:', dish);\r\n\t\t\t\tawait this.$confirm(`确认删除菜品\"${dish.name}\"吗？`, '提示', {\r\n\t\t\t\t\ttype: 'warning'\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tconst res = await new this.Request(\r\n\t\t\t\t\tthis.Urls.admin.dishDelete(dish.id)\r\n\t\t\t\t).modedelete()\r\n\t\t\t\t\r\n\t\t\t\tif (res.code === 0) {\r\n\t\t\t\t\tthis.$message.success('删除成功')\r\n\t\t\t\t\tthis.getDishesList()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$message.error(res.msg || '删除失败')\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tif (error !== 'cancel') {\r\n\t\t\t\t\tconsole.error('Delete error:', error);\r\n\t\t\t\t\tthis.$message.error('删除失败')\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n",{"version":3,"sources":["dishes-list.vue"],"names":[],"mappings":";AAwHA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"dishes-list.vue","sourceRoot":"src/page/dish-management","sourcesContent":["<template>\r\n\t<div class=\"dishes-container\">\r\n\t\t<!-- 顶部统计卡片 -->\r\n\t\t<el-row :gutter=\"20\" class=\"stat-cards\">\r\n\t\t\t<el-col :span=\"8\">\r\n\t\t\t\t<el-card shadow=\"hover\">\r\n\t\t\t\t\t<div slot=\"header\">\r\n\t\t\t\t\t\t<span>在售菜品</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"stat-number\">{{getOnSaleCount}}</div>\r\n\t\t\t\t</el-card>\r\n\t\t\t</el-col>\r\n\t\t\t<el-col :span=\"8\">\r\n\t\t\t\t<el-card shadow=\"hover\">\r\n\t\t\t\t\t<div slot=\"header\">\r\n\t\t\t\t\t\t<span>总销量</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"stat-number\">{{getTotalSales}}</div>\r\n\t\t\t\t</el-card>\r\n\t\t\t</el-col>\r\n\t\t\t<el-col :span=\"8\">\r\n\t\t\t\t<el-card shadow=\"hover\">\r\n\t\t\t\t\t<div slot=\"header\">\r\n\t\t\t\t\t\t<span>菜品总数</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"stat-number\">{{total}}</div>\r\n\t\t\t\t</el-card>\r\n\t\t\t</el-col>\r\n\t\t</el-row>\r\n\r\n\t\t<!-- 操作栏 -->\r\n\t\t<div class=\"operation-bar\">\r\n\t\t\t<div class=\"left\">\r\n\t\t\t\t<el-button type=\"primary\" icon=\"el-icon-plus\" @click=\"$router.push('/upload')\">新增菜品</el-button>\r\n\t\t\t\t<el-button type=\"warning\" icon=\"el-icon-refresh\" @click=\"getDishesList\">刷新列表</el-button>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"right\">\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<!-- 菜品列表 -->\r\n\t\t<el-table \r\n\t\t\t:data=\"dishesList\" \r\n\t\t\tborder\r\n\t\t\tv-loading=\"loading\"\r\n\t\t\telement-loading-text=\"加载中...\"\r\n\t\t\tclass=\"dish-table\">\r\n\t\t\t<el-table-column type=\"index\" label=\"序号\" width=\"60\" align=\"center\"></el-table-column>\r\n\t\t\t<el-table-column label=\"菜品图片\" width=\"120\" align=\"center\">\r\n\t\t\t\t<template slot-scope=\"scope\">\r\n\t\t\t\t\t<el-image \r\n\t\t\t\t\t\t:src=\"`${baseUrl}/image/dish/${scope.row.image}`\"\r\n\t\t\t\t\t\t:preview-src-list=\"[`${baseUrl}/image/dish/${scope.row.image}`]\"\r\n\t\t\t\t\t\tclass=\"dish-image\"\r\n\t\t\t\t\t\tfit=\"cover\">\r\n\t\t\t\t\t\t<div slot=\"error\" class=\"image-slot\">\r\n\t\t\t\t\t\t\t<i class=\"el-icon-picture-outline\"></i>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</el-image>\r\n\t\t\t\t</template>\r\n\t\t\t</el-table-column>\r\n\t\t\t<el-table-column prop=\"name\" label=\"菜品名称\" min-width=\"120\">\r\n\t\t\t\t<template slot-scope=\"scope\">\r\n\t\t\t\t\t<div class=\"dish-name\">\r\n\t\t\t\t\t\t<span>{{scope.row.name}}</span>\r\n\t\t\t\t\t\t<el-tag size=\"mini\" type=\"info\" v-if=\"scope.row.type\">{{scope.row.type.name}}</el-tag>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</template>\r\n\t\t\t</el-table-column>\r\n\t\t\t<el-table-column label=\"价格信息\" width=\"150\" align=\"center\">\r\n\t\t\t\t<template slot-scope=\"scope\">\r\n\t\t\t\t\t<div class=\"price-info\">\r\n\t\t\t\t\t\t<div class=\"price\">¥{{scope.row.unitprice}}</div>\r\n\t\t\t\t\t\t<div class=\"unit\">/ {{scope.row.unit}}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</template>\r\n\t\t\t</el-table-column>\r\n\t\t\t<el-table-column label=\"销售信息\" width=\"150\" align=\"center\">\r\n\t\t\t\t<template slot-scope=\"scope\">\r\n\t\t\t\t\t<div class=\"sales-info\">\r\n\t\t\t\t\t\t<div class=\"monthly-sales\">月销 {{scope.row.monthlysale}}</div>\r\n\t\t\t\t\t\t<div class=\"stock\">库存 {{scope.row.quantity}}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</template>\r\n\t\t\t</el-table-column>\r\n\t\t\t<el-table-column label=\"状态\" width=\"100\" align=\"center\">\r\n\t\t\t\t<template slot-scope=\"scope\">\r\n\t\t\t\t\t<el-switch\r\n\t\t\t\t\t\tv-model=\"scope.row.onsale\"\r\n\t\t\t\t\t\tactive-color=\"#13ce66\"\r\n\t\t\t\t\t\tinactive-color=\"#ff4949\"\r\n\t\t\t\t\t\t:active-text=\"scope.row.onsale ? '在售' : ''\"\r\n\t\t\t\t\t\t:inactive-text=\"!scope.row.onsale ? '停售' : ''\"\r\n\t\t\t\t\t\t@change=\"handleStatusChange(scope.row)\">\r\n\t\t\t\t\t</el-switch>\r\n\t\t\t\t</template>\r\n\t\t\t</el-table-column>\r\n\t\t\t<el-table-column label=\"操作\" width=\"200\" align=\"center\">\r\n\t\t\t\t<template slot-scope=\"scope\">\r\n\t\t\t\t\t<el-button \r\n\t\t\t\t\t\ttype=\"primary\" \r\n\t\t\t\t\t\tsize=\"mini\" \r\n\t\t\t\t\t\ticon=\"el-icon-edit\"\r\n\t\t\t\t\t\t@click=\"editDish(scope.row)\">\r\n\t\t\t\t\t\t编辑\r\n\t\t\t\t\t</el-button>\r\n\t\t\t\t\t<el-button \r\n\t\t\t\t\t\ttype=\"danger\" \r\n\t\t\t\t\t\tsize=\"mini\" \r\n\t\t\t\t\t\ticon=\"el-icon-delete\"\r\n\t\t\t\t\t\t@click=\"deleteDish(scope.row)\">\r\n\t\t\t\t\t\t删除\r\n\t\t\t\t\t</el-button>\r\n\t\t\t\t</template>\r\n\t\t\t</el-table-column>\r\n\t\t</el-table>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters } from 'vuex'\r\nimport { BASE_URL } from '@/config'\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tloading: false,\r\n\t\t\tdishesList: [],\r\n\t\t\tbaseUrl: BASE_URL\r\n\t\t}\r\n\t},\r\n\t\r\n\tcomputed: {\r\n\t\t...mapGetters(['currentMerchant']),\r\n\t\tgetOnSaleCount() {\r\n\t\t\treturn this.dishesList.filter(dish => dish.onsale).length\r\n\t\t},\r\n\t\tgetTotalSales() {\r\n\t\t\treturn this.dishesList.reduce((sum, dish) => sum + dish.monthlysale, 0)\r\n\t\t}\r\n\t},\r\n\t\r\n\tcreated() {\r\n\t\tthis.getDishesList()\r\n\t},\r\n\t\r\n\tmethods: {\r\n\t\t// 获取菜品列表\r\n\t\tasync getDishesList() {\r\n\t\t\tthis.loading = true\r\n\t\t\ttry {\r\n\t\t\t\tconst params = {\r\n\t\t\t\t\tmerchantId: this.currentMerchant.id\r\n\t\t\t\t}\r\n\t\t\t\tconst res = await new this.Request('/admin/dish/list').modepost(params)\r\n\t\t\t\t\r\n\t\t\t\tif (res.code === 0) {\r\n\t\t\t\t\tthis.dishesList = res.dishList || []\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$message.error(res.msg || '获取菜品列表失败')\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('获取菜品列表失败：', error)\r\n\t\t\t\tthis.$message.error('获取菜品列表失败')\r\n\t\t\t} finally {\r\n\t\t\t\tthis.loading = false\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 修改菜品状态\r\n\t\tasync handleStatusChange(dish) {\r\n\t\t\ttry {\r\n\t\t\t\tconst params = {\r\n\t\t\t\t\tid: dish.id,\r\n\t\t\t\t\tonsale: dish.onsale,\r\n\t\t\t\t\tmerchantId: this.currentMerchant.id\r\n\t\t\t\t}\r\n\t\t\t\tconst res = await new this.Request('/admin/dish/updateOnSale', params).modepost()\r\n\t\t\t\t\r\n\t\t\t\tif (res.code === 0) {\r\n\t\t\t\t\tthis.$message.success('状态修改成功')\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdish.onsale = !dish.onsale // 恢复状态\r\n\t\t\t\t\tthis.$message.error(res.msg || '状态修改失败')\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tdish.onsale = !dish.onsale // 恢复状态\r\n\t\t\t\tthis.$message.error('状态修改失败')\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 编辑菜品\r\n\t\teditDish(dish) {\r\n\t\t\tthis.$router.push({\r\n\t\t\t\tname: 'upload',\r\n\t\t\t\tparams: { item: dish }\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\t// 删除菜品\r\n\t\tasync deleteDish(dish) {\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log('Deleting dish:', dish);\r\n\t\t\t\tawait this.$confirm(`确认删除菜品\"${dish.name}\"吗？`, '提示', {\r\n\t\t\t\t\ttype: 'warning'\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tconst res = await new this.Request(\r\n\t\t\t\t\tthis.Urls.admin.dishDelete(dish.id)\r\n\t\t\t\t).modedelete()\r\n\t\t\t\t\r\n\t\t\t\tif (res.code === 0) {\r\n\t\t\t\t\tthis.$message.success('删除成功')\r\n\t\t\t\t\tthis.getDishesList()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$message.error(res.msg || '删除失败')\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tif (error !== 'cancel') {\r\n\t\t\t\t\tconsole.error('Delete error:', error);\r\n\t\t\t\t\tthis.$message.error('删除失败')\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.dishes-container {\r\n\tpadding: 20px;\r\n}\r\n\r\n.stat-cards {\r\n\tmargin-bottom: 20px;\r\n}\r\n\r\n.stat-number {\r\n\tfont-size: 24px;\r\n\tfont-weight: bold;\r\n\tcolor: #409EFF;\r\n\ttext-align: center;\r\n}\r\n\r\n.operation-bar {\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n\talign-items: center;\r\n\tmargin-bottom: 20px;\r\n\tbackground: #f5f7fa;\r\n\tpadding: 15px;\r\n\tborder-radius: 4px;\r\n}\r\n\r\n.search-input {\r\n\twidth: 300px;\r\n}\r\n\r\n.dish-table {\r\n\tmargin-bottom: 20px;\r\n}\r\n\r\n.dish-image {\r\n\twidth: 60px;\r\n\theight: 60px;\r\n\tborder-radius: 4px;\r\n}\r\n\r\n.image-slot {\r\n\tdisplay: flex;\r\n\tjustify-content: center;\r\n\talign-items: center;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tbackground: #f5f7fa;\r\n\tcolor: #909399;\r\n\tfont-size: 20px;\r\n}\r\n\r\n.dish-name {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tgap: 8px;\r\n}\r\n\r\n.price-info {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\talign-items: center;\r\n}\r\n\r\n.price {\r\n\tfont-size: 16px;\r\n\tfont-weight: bold;\r\n\tcolor: #f56c6c;\r\n}\r\n\r\n.unit {\r\n\tfont-size: 12px;\r\n\tcolor: #909399;\r\n}\r\n\r\n.sales-info {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\talign-items: center;\r\n\tgap: 4px;\r\n}\r\n\r\n.monthly-sales {\r\n\tcolor: #67c23a;\r\n}\r\n\r\n.stock {\r\n\tcolor: #909399;\r\n\tfont-size: 12px;\r\n}\r\n\r\n.el-button + .el-button {\r\n\tmargin-left: 10px;\r\n}\r\n\r\n.el-switch {\r\n\tmargin: 0 8px;\r\n}\r\n</style>\r\n"]}]}